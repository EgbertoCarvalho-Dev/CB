{% include "default/Structure/Header.twig" %}
<h3 class="text-dark mb-1">Lançamentos</h3>
<div class="row">
    <div class="col">
        <div class="card shadow mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="text-primary fw-bold m-0">Lista</h6>
                <button class="btn btn-link btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#addItem">
                    <i class="fas fa-plus text-gray-400"></i>
                </button>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Placa do Veiculo</th>
                                <th>Fornecedor</th>
                                <th>Tipo de Carga</th>
                                <th>Item</th>
                                <th>Data Pesagem Inicial</th>
                                <th>Data Pesagem Final</th>
                                <th>Valor da Nota</th>
                                <th></th>
                                <th></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if entries|length == 0%}
                            <tr>
                                <td colspan="6">Não lançamento cadastrado neste momento.</td>
                            </tr>
                            {% endif %}
                            {% for entry in entries %}
                            <tr>
                                <td>{{ entry.id }}</td>
                                <td>{{ entry.car }}</td>
                                <td>{{ entry.supplier }}</td>
                                <td>
                                    {% if entry.type == 'M' %}
                                    <span class="badge bg-primary">M³</span>
                                    {% else %}
                                    <span class="badge bg-success">KG</span>
                                    {% endif %}
                                </td>
                                <td>{{ entry.item }}</td>
                                <td>
                                    {{entry.startpost|date('d/m/Y H:m')}}
                                </td>
                                <td>
                                    {{entry.endpost|date('d/m/Y H:m')}}
                                </td>
                                <td>R$ {{ entry.total|number_format(2, '.', ',')}}</td>
                                <td class="text-center">
                                    <button onclick="showDetailsEntry('{{ entry.id }}')" class="btn btn-info"
                                        type="button">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                                <td class="text-center">
                                    {% if user_logged.level == 'adm' %}
                                    <button onclick="editEntry('{{ entry.id }}')" class="btn btn-warning" type="button">
                                        <i class="fas fa-pencil-alt"></i>
                                    </button>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    {% if user_logged.level == 'adm' %}
                                    <a href="{{ url }}lancamentos/delete/{{ entry.id }}" class="btn btn-danger"
                                        type="button">
                                        <i class="far fa-trash-alt"></i>
                                    </a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<form action="{{ url }}lancamentos/edit" enctype="multipart/form-data" method="POST">
    <div class="modal fade" role="dialog" tabindex="-1" id="editItem">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">
                        Alterar Lançamento
                    </h4>
                    <button class="btn-close" type="button" aria-label="Close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" id="idEntry">
                    <div class="mb-3">
                        <label for="" class="form-label">Veiculo</label>
                        <select class="form-select" name="car" id="carEdit">
                            <option selected>Selecionar</option>
                            {% for car in cars %}
                            <option value="{{ car.id }}">{{ car.name }} - {{ car.placa }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <p style="margin-bottom: 4px;"></p>
                    <div class="mb-3">
                        <label for="" class="form-label">Fornecedor</label>
                        <select class="form-select" name="supplier" id="supplierEdit">
                            <option selected>Selecionar</option>
                            {% for supplier in suppliers %}
                            <option value="{{ supplier.id }}">{{ supplier.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <label class="form-label">Item</label>
                    <p style="margin-bottom: 5px;"></p>
                    <div class="input-group">
                        <input name="item" id="itemEdit" class="form-control" type="text" style="margin-bottom: 10px;">
                    </div>
                    <label for="" class="form-label">Tipo de Carga</label>
                    <div class="card shadow p-3">
                        <h6>Selecione o tipo de carga</h6>
                        <div class="form-check">
                            <input class="form-check-input" id="meterTypeEdit"
                                onchange="selectWeight(this.value, 'Edit')" value="M" type="radio" name="typeWeight">
                            <label class="form-check-label" for="">
                                M³
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" value="K" id="kiloTypeEdit"
                                onchange="selectWeight(this.value, 'Edit')" type="radio" name="typeWeight">
                            <label class="form-check-label" for="">
                                KG
                            </label>
                        </div>

                        <div id="meterWeightEdit" class="weightDetails" style="display: none;">
                            <hr>
                            <div class="mb-3">
                                <label for="" class="form-label">Largura</label>
                                <input oninput="onChangeMeter('Edit')" value="0" type="text" class="meters form-control"
                                    name="meter[width]" id="widthInputEdit" aria-describedby="helpId" placeholder="">
                                <small id="helpId" class="form-text text-muted">Em Metros</small>
                            </div>
                            <div class="mb-3">
                                <label for="" class="form-label">Comprimento</label>
                                <input oninput="onChangeMeter('Edit')" value="0" type="text" class="meters form-control"
                                    name="meter[length]" id="lengthInputEdit" aria-describedby="helpId" placeholder="">
                                <small id="helpId" class="form-text text-muted">Em Metros</small>
                            </div>
                            <div class="mb-3">
                                <label for="" class="form-label">Altura</label>
                                <input oninput="onChangeMeter('Edit')" value="0" type="text" class="meters form-control"
                                    name="meter[height]" id="heightInputEdit" aria-describedby="helpId" placeholder="">
                                <small id="helpId" class="form-text text-muted">Em Metros</small>
                            </div>
                            <div class="mb-3">
                                <label for="" class="form-label">Valor Metro Cúbico</label>
                                <input oninput="inputMeterValue(this.value, 'Edit');" value="0" type="text"
                                    class="meters form-control" name="meter[cubic]" id="valueInputMeterEdit"
                                    aria-describedby="helpId" placeholder="">
                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <p>
                                        Largura:
                                        <br>
                                        Comprimento:
                                        <br>
                                        Altura:
                                        <br>
                                        Metros Cubicos:

                                    </p>
                                </div>
                                <div class="col-6 text-center">
                                    <span id="widthEdit">0</span>
                                    <br>
                                    <span id="lengthEdit">0</span>
                                    <br>
                                    <span id="heightEdit">0</span>
                                    <br>
                                    <span id="cubicMetersEdit">0</span>
                                    <hr>
                                    <span id="noteTotalEdit"></span>
                                </div>
                            </div>
                        </div>
                        <div id="kiloWeightEdit" class="weightDetails" style="display: none;">
                            <hr>
                            <div class="mb-3">
                                <label for="" class="form-label">Peso Inicial</label>
                                <input type="text" value="0" oninput="updateWeightPrice('Edit')" class="form-control"
                                    name="weight[start]" id="startWeightInputEdit" aria-describedby="helpId"
                                    placeholder="">
                            </div>
                            <div class="mb-3">
                                <label for="" class="form-label">Peso Final</label>
                                <input type="text" value="0" oninput="updateWeightPrice('Edit')" class="form-control"
                                    name="weight[end]" id="endWeightInputEdit" aria-describedby="helpId" placeholder="">
                            </div>
                            <div class="mb-3">
                                <label for="" class="form-label">Valor KG</label>
                                <input type="text" value="0" oninput="updateWeightPrice('Edit')" class="form-control"
                                    name="weight[value]" id="valueWeightInputEdit" aria-describedby="helpId"
                                    placeholder="">
                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <p>
                                        Peso Inicial:
                                        <br>
                                        Peso Final:
                                        <br>
                                        Peso Liquido:
                                        <br>
                                        Valor KG:
                                    </p>
                                </div>
                                <div class="col-6 text-center">
                                    <span id="startWeightEdit">0</span>
                                    <br>
                                    <span id="endWeightEdit">0</span>
                                    <br>
                                    <span id="liquidWeightEdit">0</span>
                                    <br>
                                    <span id="totalValueEdit">0</span>
                                    <hr>
                                    <span id="noteTotalWeightEdit"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <label class="form-label" style="margin-top: 15px;">
                        Valor da Nota
                    </label>
                    <div class="input-group">
                        <input class="form-control" type="text" id="noteValueEdit" name="total" id="noteValue">
                    </div>
                    <label class="form-label" style="margin-top: 15px;">
                        Gestor
                    </label>
                    <div class="input-group">
                        <select class="form-select" name="manager" id="managerEdit">
                            <option value="0" selected="">Selecione</option>
                            {% for user in users %}
                            <option value="{{ user.id }}">{{ user.name }} - {{ user.email }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <label class="form-label" style="margin-top: 15px;">
                        Responsável pelo Setor
                    </label>
                    <div class="input-group">
                        <select class="form-select" name="responsible" id="responsibleEdit">
                            <option value="0" selected="">Selecione</option>
                            {% for user in users %}
                            <option value="{{ user.id }}">{{ user.name }} - {{ user.email }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3 mt-3">
                        <label for="" class="form-label">Data Pesagem Inicial</label>
                        <input type="datetime-local" class="form-control" id="startPostEdit" name="startpost"
                            aria-describedby="helpId" placeholder="">
                    </div>
                    <div class="mb-3">
                        <label for="" class="form-label">Data Pesagem Final</label>
                        <input type="datetime-local" class="form-control" id="endPostEdit" name="endpost"
                            aria-describedby="helpId" placeholder="">
                    </div>
                    <label class="form-label" style="margin-top: 15px;">
                        Observação
                    </label>
                    <div class="input-group">
                        <textarea class="form-control" name="observation" id="observationEdit"></textarea>
                    </div>

                </div>
                <div class="modal-footer">
                    <button class="btn btn-light" type="button" data-bs-dismiss="modal">
                        Fechar
                    </button>
                    <button class="btn btn-primary" type="submit">
                        Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>
<form action="{{ url }}lancamentos/add" enctype="multipart/form-data" method="POST">
    <div class="modal fade" role="dialog" tabindex="-1" id="addItem">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">
                        Adicionar Lançamento
                    </h4>
                    <button class="btn-close" type="button" aria-label="Close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">

                    <div class="mb-3">
                        <label for="" class="form-label">Veiculo</label>
                        <select class="form-select" name="car">
                            <option selected>Selecionar</option>
                            {% for car in cars %}
                            <option value="{{ car.id }}">{{ car.name }} - {{ car.placa }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <p style="margin-bottom: 4px;"></p>
                    <div class="mb-3">
                        <label for="" class="form-label">Fornecedor</label>
                        <select class="form-select" name="supplier">
                            <option selected>Selecionar</option>
                            {% for supplier in suppliers %}
                            <option value="{{ supplier.id }}">{{ supplier.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <label class="form-label">Item</label>
                    <p style="margin-bottom: 5px;"></p>
                    <div class="input-group">
                        <input name="item" class="form-control" type="text" style="margin-bottom: 10px;">
                    </div>
                    <label for="" class="form-label">Tipo de Carga</label>
                    <div class="card shadow p-3">
                        <h6>Selecione o tipo de carga</h6>
                        <div class="form-check">
                            <input class="form-check-input" onchange="selectWeight(this.value, 'Add')" value="M"
                                type="radio" name="typeWeight">
                            <label class="form-check-label" for="">
                                M³
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" value="K" onchange="selectWeight(this.value, 'Add')"
                                type="radio" name="typeWeight">
                            <label class="form-check-label" for="">
                                KG
                            </label>
                        </div>

                        <div id="meterWeightAdd" class="weightDetails" style="display: none;">
                            <hr>
                            <div class="mb-3">
                                <label for="" class="form-label">Largura</label>
                                <input oninput="onChangeMeter('Add')" value="0" type="text" class="meters form-control"
                                    name="meter[width]" id="widthInputAdd" aria-describedby="helpId" placeholder="">
                                <small id="helpId" class="form-text text-muted">Em Metros</small>
                            </div>
                            <div class="mb-3">
                                <label for="" class="form-label">Comprimento</label>
                                <input oninput="onChangeMeter('Add')" value="0" type="text" class="meters form-control"
                                    name="meter[length]" id="lengthInputAdd" aria-describedby="helpId" placeholder="">
                                <small id="helpId" class="form-text text-muted">Em Metros</small>
                            </div>
                            <div class="mb-3">
                                <label for="" class="form-label">Altura</label>
                                <input oninput="onChangeMeter('Add')" value="0" type="text" class="meters form-control"
                                    name="meter[height]" id="heightInputAdd" aria-describedby="helpId" placeholder="">
                                <small id="helpId" class="form-text text-muted">Em Metros</small>
                            </div>
                            <div class="mb-3">
                                <label for="" class="form-label">Valor Metro Cúbico</label>
                                <input oninput="inputMeterValue(this.value, 'Add');" value="0" type="text"
                                    class="meters form-control" name="meter[cubic]" id="valueInputMeterAdd"
                                    aria-describedby="helpId" placeholder="">
                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <p>
                                        Largura:
                                        <br>
                                        Comprimento:
                                        <br>
                                        Altura:
                                        <br>
                                        Metros Cubicos:

                                    </p>
                                </div>
                                <div class="col-6 text-center">
                                    <span id="widthAdd">0</span>
                                    <br>
                                    <span id="lengthAdd">0</span>
                                    <br>
                                    <span id="heightAdd">0</span>
                                    <br>
                                    <span id="cubicMetersAdd">0</span>
                                    <hr>
                                    <span id="noteTotalAdd"></span>
                                </div>
                            </div>
                        </div>
                        <div id="kiloWeightAdd" class="weightDetails" style="display: none;">
                            <hr>
                            <div class="mb-3">
                                <label for="" class="form-label">Peso Inicial</label>
                                <input type="text" value="0" oninput="updateWeightPrice('Add')" class="form-control"
                                    name="weight[start]" id="startWeightInputAdd" aria-describedby="helpId"
                                    placeholder="">
                            </div>
                            <div class="mb-3">
                                <label for="" class="form-label">Peso Final</label>
                                <input type="text" value="0" oninput="updateWeightPrice('Add')" class="form-control"
                                    name="weight[end]" id="endWeightInputAdd" aria-describedby="helpId" placeholder="">
                            </div>
                            <div class="mb-3">
                                <label for="" class="form-label">Valor KG</label>
                                <input type="text" value="0" oninput="updateWeightPrice('Add')" class="form-control"
                                    name="weight[value]" id="valueWeightInputAdd" aria-describedby="helpId"
                                    placeholder="">
                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <p>
                                        Peso Inicial:
                                        <br>
                                        Peso Final:
                                        <br>
                                        Peso Liquido:
                                        <br>
                                        Valor KG:
                                    </p>
                                </div>
                                <div class="col-6 text-center">
                                    <span id="startWeightAdd">0</span>
                                    <br>
                                    <span id="endWeightAdd">0</span>
                                    <br>
                                    <span id="liquidWeightAdd">0</span>
                                    <br>
                                    <span id="totalValueAdd">0</span>
                                    <hr>
                                    <span id="noteTotalWeightAdd"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <label class="form-label" style="margin-top: 15px;">
                        Valor da Nota
                    </label>
                    <div class="input-group">
                        <input class="form-control" type="text" name="total" id="noteValueAdd">
                    </div>
                    <label class="form-label" style="margin-top: 15px;">
                        Gestor
                    </label>
                    <div class="input-group">
                        <select class="form-select" name="manager">
                            <option value="0" selected="">Selecione</option>
                            {% for user in users %}
                            <option value="{{ user.id }}">{{ user.name }} - {{ user.email }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <label class="form-label" style="margin-top: 15px;">
                        Responsável pelo Setor
                    </label>
                    <div class="input-group">
                        <select class="form-select" name="responsible">
                            <option value="0" selected="">Selecione</option>
                            {% for user in users %}
                            <option value="{{ user.id }}">{{ user.name }} - {{ user.email }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3 mt-3">
                        <label for="" class="form-label">Data Pesagem Inicial</label>
                        <input type="datetime-local" class="form-control" name="startpost" aria-describedby="helpId"
                            placeholder="">
                    </div>
                    <div class="mb-3">
                        <label for="" class="form-label">Data Pesagem Final</label>
                        <input type="datetime-local" class="form-control" name="endpost" aria-describedby="helpId"
                            placeholder="">
                    </div>
                    <label class="form-label" style="margin-top: 15px;">
                        Observação
                    </label>
                    <div class="input-group">
                        <textarea class="form-control" name="observation"></textarea>
                    </div>

                </div>
                <div class="modal-footer">
                    <button class="btn btn-light" type="button" data-bs-dismiss="modal">
                        Fechar
                    </button>
                    <button class="btn btn-primary" type="submit">
                        Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>
<!-- Modal Body -->
<!-- if you want to close by clicking outside the modal, delete the last endpoint:data-bs-backdrop and data-bs-keyboard -->
<div class="modal fade" id="showDetail" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog"
    aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitleId">Exibir Detalhes</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row" id="generalDetail">
                    <div class="col-6 text-end">
                        <p class="text-muted">
                            Data do Lançamento:
                            <br>
                            ID:
                            <br>
                            Veiculo:
                            <br>
                            Fornecedor:
                            <br>
                            Item:
                            <br>
                            Valor da Nota:
                            <br>
                            Gestor:
                            <br>
                            Responsável:
                            <br>
                            Data da Pesagem Inicial:
                            <br>
                            Data da Pesagem Final:
                            <br>
                            Tipo de Carga:
                            <br>
                            Observação:
                            <br>

                        </p>
                    </div>
                    <div class="col-6 fw-semibold">
                        <p>
                            <span id="dateCreated"></span>
                            <br>
                            <span id="idEntry"></span>
                            <br>
                            <span id="carEntry"></span>
                            <br>
                            <span id="supplierEntry"></span>
                            <br>
                            <span id="itemEntry"></span>
                            <br>
                            <span id="valueEntry"></span>
                            <br>
                            <span id="managerEntry"></span>
                            <br>
                            <span id="responsibleEntry"></span>
                            <br>
                            <span id="startEntry"></span>
                            <br>
                            <span id="finalEntry"></span>
                            <br>
                            <span id="typeEntry"></span>
                            <br>
                            <span id="observation"></span>
                        </p>
                    </div>
                </div>
                <hr>
                <h6 class="fw-bold">Descrição da Carga</h6>
                <div class="row" id="bodyKG">
                    <div class="col-6">
                        <p>
                            Peso Inicial:
                            <br>
                            Peso Final:
                            <br>
                            Peso Liquido:
                            <br>
                            Valor KG:
                        </p>
                    </div>
                    <div class="col-6 text-center">
                        <span id="startWeightDetail">0</span>
                        <br>
                        <span id="endWeightDetail">0</span>
                        <br>
                        <span id="liquidWeightDetail">0</span>
                        <br>
                        <span id="totalValueDetail">0</span>
                        <hr>
                        <span id="noteTotalWeightDetail"></span>
                    </div>
                </div>
                <div class="row" id="bodyMeter">
                    <div class="col-6">
                        <p>
                            Largura:
                            <br>
                            Comprimento:
                            <br>
                            Altura:
                            <br>
                            Metros Cubicos:

                        </p>
                    </div>
                    <div class="col-6 text-center">
                        <span id="widthDetail">0</span>
                        <br>
                        <span id="lengthDetail">0</span>
                        <br>
                        <span id="heightDetail">0</span>
                        <br>
                        <span id="cubicMetersDetail">0</span>
                        <hr>
                        <span id="noteTotalDetail"></span>
                    </div>
                </div>
                <div id="loadItem">
                    <div class="d-flex justify-content-center align-items-center">
                        <div class="spinner-border text-primary spinner-border-sm" role="status"
                            style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                <button type="button" id="btnPrint" class="btn btn-primary">Imprimir</button>
            </div>
        </div>
    </div>
</div>

<script>
    function showDetailsEntry(id) {
        $.ajax({
            url: '{{ url }}lancamentos/get',
            method: 'POST',
            data: {
                id: id
            },
            beforeSend: function () {
                $('#generalDetail').hide();
                $('#bodyMeter').hide();
                $('#bodyKG').hide();
                $('#loadItem').show();
                $('#showDetail').modal('show');
            },
            success: function (data) {
                console.log(data);
                $('#btnPrint').attr('onclick', 'printDocument("' + data.id + '")');
                let price = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(data.total);
                $('#idEntry').html(data.id);
                $('#carEntry').html(data.car);
                $('#supplierEntry').html(data.supplier);
                $('#itemEntry').html(data.item);
                $('#valueEntry').html(price);
                $('#managerEntry').html(data.manager);
                $('#startEntry').html(data.startpost);
                $('#finalEntry').html(data.endpost);
                $('#observation').html(data.observation);
                $('#responsibleEntry').html(data.responsible);
                $('#dateCreated').html(data.created_at);
                let type;
                if (data.type == 'K') {
                    $('#startWeightDetail').html(data.attribute.start + ' KG');
                    $('#endWeightDetail').html(data.attribute.end + ' KG');
                    let valueNote = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(data.attribute.value);
                    $('#liquidWeightDetail').html((data.attribute.end - data.attribute.start) + ' KG');
                    $('#totalValueDetail').html(valueNote);

                    $('#noteTotalWeightDetail').html(price);


                    type = '<span class="badge bg-success">KG</span>';
                } else {
                    $('#widthDetail').html(data.attribute.width);
                    $('#lengthDetail').html(data.attribute.length);
                    $('#heightDetail').html(data.attribute.height);
                    $('#cubicMetersDetail').html(data.attribute.cubic);
                    let valueNote = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(data.total);
                    $('#noteTotalDetail').html(valueNote);
                    $('#bodyMeter').fadeIn('normal');
                    type = '<span class="badge bg-primary">M³</span>';

                }
                $('#typeEntry').html(type);
                $('#loadItem').fadeOut('normal', function () {
                    if (data.type == 'K') {
                        $('#bodyKG').fadeIn('normal');
                    } else {
                        $('#bodyMeter').fadeIn('normal');
                    }
                    $('#generalDetail').fadeIn('normal');

                });
            }
        })
    }
    function printDocument(id) {
        window.open('{{ url }}lancamentos/print/' + id);
    }
    function editEntry(id) {
        $.ajax({
            url: '{{ url }}lancamentos/get',
            method: 'POST',
            data: {
                id: id
            },
            beforeSend: function () {
                $('#editItem').modal('show');

            },
            success: function (data) {
                $('#idEntry').val(id);
                console.log(data);
                $.each($('#carEdit').children(), function (key, obj) {
                    if ($(obj).html().includes(data.car)) {
                        $('#carEdit').val($(obj).attr('value'));
                    }
                })
                $.each($('#supplierEdit').children(), function (key, obj) {
                    if ($(obj).html().includes(data.supplier)) {
                        $('#supplierEdit').val($(obj).attr('value'));
                    }
                })
                $('#itemEdit').val(data.item);
                $('#valueTotalEdit').val(data.total);
                $.each($('#managerEdit').children(), function (key, obj) {
                    if ($(obj).html().includes(data.manager)) {
                        $('#managerEdit').val($(obj).attr('value'));
                    }
                })

                $.each($('#responsibleEdit').children(), function (key, obj) {
                    if ($(obj).html().includes(data.responsible)) {
                        $('#responsibleEdit').val($(obj).attr('value'));
                    }
                })

                $('#startPostEdit').val(data.startpost);
                $('#endPostEdit').val(data.endpost);
                $('#observationEdit').html(data.observation)

                if (data.type == 'K') {
                    selectWeight('K', 'Edit');
                    $('#kiloTypeEdit').prop('checked', true);
                    $('#startWeightInputEdit').val(data.attribute.start);
                    $('#endWeightInputEdit').val(data.attribute.end);
                    $('#valueWeightInputEdit').val(data.attribute.value);
                    updateWeightPrice('Edit');
                } else {
                    selectWeight('M', 'Edit');
                    $('#meterTypeEdit').prop('checked', true);
                    $('#widthInputEdit').val(data.attribute.width);
                    $('#lengthInputEdit').val(data.attribute.length);
                    $('#heightInputEdit').val(data.attribute.height);
                    $('#valueInputMeterEdit').val(data.attribute.cubic)
                    onChangeMeter('Edit');
                    let price = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(data.total);
                    $('#noteTotalEdit').html(price);

                }

            }
        })
    }
    function onChangeMeter(type) {
        let width = $('#widthInput' + type).val();
        let length = $('#lengthInput' + type).val();
        let height = $('#heightInput' + type).val();

        $('#width' + type).html(width);
        $('#length' + type).html(length);
        $('#height' + type).html(height);

        $('#cubicMeters' + type).html((width * length * height));
        inputMeterValue($('#valueInputMeter' + type).val(), type);
    }
    function inputMeterValue(value, type) {
        let price = $('#cubicMeters' + type).html() * value;
        $('#noteValue' + type).val(price);
        price = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(price);
        $('#noteTotal' + type).html(price);
    }
    function updateWeightPrice(type) {
        let startWeight = $('#startWeightInput' + type).val();
        let endWeight = $('#endWeightInput' + type).val();
        let valueInput = $('#valueWeightInput' + type).val();
        let liquidWeight = endWeight - startWeight;


        $('#startWeight' + type).html(startWeight);
        $('#endWeight' + type).html(endWeight);
        $('#totalValue' + type).html(valueInput);
        $('#liquidWeight' + type).html(liquidWeight);

        let price = liquidWeight * valueInput;
        $('#noteValue' + type).val(price);
        price = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(price);
        $('#noteTotalWeight' + type).html(price);
    }
    function selectWeight(value, type) {
        $('.weightDetails').slideUp('normal', function () {

            if (value == 'K') {
                $('#kiloWeight' + type).slideDown('normal');
            } else {
                $('#meterWeight' + type).slideDown('normal');
            }
        })
    }
</script>
{% include "default/Structure/Footer.twig" %}